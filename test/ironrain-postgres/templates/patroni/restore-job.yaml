---
# Source: ironrain-postgres/templates/patroni/restore-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: pi
spec:
  template:
    spec:
      containers:
      - name: test-job
        volumeMounts:
        - name: pgdata        
          mountPath: /var/lib/postgresql/data          
        - name: pgbackrest-config
          mountPath: "/etc/pgbackrest"      
        image: ironrainio/postgres:12
        command: 
        - pgbackrest
        - --stanza=database
        - --log-level-console=info
        - restore
      restartPolicy: Never
      volumes:            
      - name: pgbackrest-config
        configMap:
          name: postgres-pgbackrest-config
          items:
          - key: pgbackrest.conf
            path: pgbackrest.conf
  backoffLimit: 4
